#!/bin/bash

case "$1" in
  start)
    cd /home/ubuntu/lbpark/current && COUNT=2 RAILS_ENV=production PIDFILE=/home/ubuntu/lbpark/shared/tmp/pids/resque.pid BACKGROUND=yes QUEUE=* rake resque:work
    cd /home/ubuntu/lbpark/current && RESQUE_SCHEDULER_INTERVAL=1  LOGFILE=/home/ubuntu/lbpark/shared/log/resque_scheduler.log  RAILS_ENV=production PIDFILE=/home/ubuntu/lbpark/shared/tmp/pids/resque_scheduler.pid BACKGROUND=yes rake resque:scheduler
    ;;

  stop)
    if [ 0 -eq $(kill 0 `cat /home/ubuntu/lbpark/shared/tmp/pids/resque.pid`) ]
    then
      kill -QUIT `cat /home/ubuntu/lbpark/shared/tmp/pids/resque.pid`
      sleep 3
      kill -INT `cat /home/ubuntu/lbpark/shared/tmp/pids/resque.pid`
    fi;

    if [ 0 -eq $(kill 0 `cat /home/ubuntu/lbpark/shared/tmp/pids/resque_scheduler.pid`) ]
    then
      kill -QUIT `cat /home/ubuntu/lbpark/shared/tmp/pids/resque_scheduler.pid`
      sleep 3
      kill -INT `cat /home/ubuntu/lbpark/shared/tmp/pids/resque_scheduler.pid`
    fi;
esac

